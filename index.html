<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Flight Distance, Time & Block Time Calculator</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  label { display: block; margin: 10px 0 5px; }
  input { padding: 8px; width: 100%; max-width: 300px; }
  button { padding: 10px 15px; margin-top: 10px; }
  .result { margin-top: 20px; padding: 15px; border: 1px solid #ccc; max-width: 600px; white-space: pre-wrap; }
  .warning { color: red; font-weight: bold; }
</style>
</head>
<body>

<h1>Flight Distance, Time & Block Time Calculator</h1>

<label for="origin">Origin IATA Code:</label>
<input type="text" id="origin" maxlength="3" placeholder="e.g. JFK" />

<label for="destination">Destination IATA Code:</label>
<input type="text" id="destination" maxlength="3" placeholder="e.g. LHR" />

<label for="aircraft">Aircraft Code (e.g. B738, A320):</label>
<input type="text" id="aircraft" maxlength="5" placeholder="e.g. B738" />

<button onclick="calculateFlight()">Calculate</button>

<div id="result" class="result" style="display:none;"></div>

<script>
const aircraftInfo = {
  B733: { model: "Boeing 737-300", speed: 485, maxRangeNM: 2000 },
  B734: { model: "Boeing 737-400", speed: 485, maxRangeNM: 2300 },
  B735: { model: "Boeing 737-500", speed: 485, maxRangeNM: 1900 },
  B736: { model: "Boeing 737-600", speed: 470, maxRangeNM: 2200 },
  B737: { model: "Boeing 737-700", speed: 485, maxRangeNM: 3150 },
  B738: { model: "Boeing 737-800", speed: 485, maxRangeNM: 2800 },
  B739: { model: "Boeing 737-900", speed: 485, maxRangeNM: 2950 },
  B744: { model: "Boeing 747-400", speed: 560, maxRangeNM: 7280 },
  B748: { model: "Boeing 747-8", speed: 570, maxRangeNM: 8000 },
  B752: { model: "Boeing 757-200", speed: 510, maxRangeNM: 3900 },
  B753: { model: "Boeing 757-300", speed: 510, maxRangeNM: 3650 },
  B762: { model: "Boeing 767-200", speed: 530, maxRangeNM: 3950 },
  B763: { model: "Boeing 767-300", speed: 530, maxRangeNM: 3650 },
  B772: { model: "Boeing 777-200", speed: 560, maxRangeNM: 5235 },
  B773: { model: "Boeing 777-300", speed: 560, maxRangeNM: 4865 },
  B788: { model: "Boeing 787-8", speed: 560, maxRangeNM: 7355 },
  B789: { model: "Boeing 787-9", speed: 560, maxRangeNM: 7600 },
  A318: { model: "Airbus A318", speed: 470, maxRangeNM: 3050 },
  A319: { model: "Airbus A319", speed: 470, maxRangeNM: 3400 },
  A320: { model: "Airbus A320", speed: 510, maxRangeNM: 3300 },
  A321: { model: "Airbus A321", speed: 510, maxRangeNM: 3600 },
  A332: { model: "Airbus A330-200", speed: 515, maxRangeNM: 7400 },
  A333: { model: "Airbus A330-300", speed: 515, maxRangeNM: 6500 },
  A343: { model: "Airbus A340-300", speed: 500, maxRangeNM: 7000 },
  A350: { model: "Airbus A350-900", speed: 560, maxRangeNM: 8100 },
  A388: { model: "Airbus A380", speed: 560, maxRangeNM: 8200 },
  CRJ7: { model: "Bombardier CRJ700", speed: 465, maxRangeNM: 1200 },
  CRJ9: { model: "Bombardier CRJ900", speed: 460, maxRangeNM: 1560 },
  E170: { model: "Embraer E170", speed: 460, maxRangeNM: 1600 },
  E190: { model: "Embraer E190", speed: 460, maxRangeNM: 2400 }
};

// Typical fixed block time additions for taxi and ground ops (minutes)
const fixedBlockMinutes = 30;  // 15 min taxi-out + 15 min taxi-in typical

function formatFlightTime(hours) {
  const h = Math.floor(hours);
  const m = Math.round((hours - h) * 60);
  return `${h} hr ${m} min`;
}

async function fetchDistance(origin, destination, token) {
  const response = await fetch('https://airportgap.com/api/airports/distance', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': 'Bearer token=' + token
    },
    body: JSON.stringify({ from: origin.toUpperCase(), to: destination.toUpperCase() })
  });

  if (!response.ok) throw new Error('API error: ' + response.statusText);
  return response.json();
}

async function calculateFlight() {
  const origin = document.getElementById('origin').value.trim().toUpperCase();
  const destination = document.getElementById('destination').value.trim().toUpperCase();
  const aircraftCode = document.getElementById('aircraft').value.trim().toUpperCase();
  const token = '4qMWUC5HS9Fsn1vBv9xkzz6g'; // Replace with your API token

  if (origin.length !== 3 || destination.length !== 3) {
    alert('Please enter valid 3-letter IATA codes for both origin and destination.');
    return;
  }
  if (!aircraftCode) {
    alert('Please enter a valid aircraft code.');
    return;
  }
  if (!(aircraftCode in aircraftInfo)) {
    alert('Unknown aircraft code. Please enter a valid commercial aircraft code.');
    return;
  }

  try {
    const data = await fetchDistance(origin, destination, token);
    const attrs = data.data.attributes;
    const nm = attrs.nautical_miles;
    const aircraft = aircraftInfo[aircraftCode];
    const cruiseTime = nm / aircraft.speed; // in hours
    const blockTime = cruiseTime + fixedBlockMinutes / 60; // add block time in hours

    let message = `Flight Information
--------------------------
From: ${attrs.from_airport.name} (${attrs.from_airport.iata}/${attrs.from_airport.icao}), ${attrs.from_airport.city}, ${attrs.from_airport.country}, ${attrs.from_airport.continent}
To: ${attrs.to_airport.name} (${attrs.to_airport.iata}/${attrs.to_airport.icao}), ${attrs.to_airport.city}, ${attrs.to_airport.country}, ${attrs.to_airport.continent}

Distance: ${nm.toFixed(2)} nautical miles

Estimated Flight Time (cruise): ${formatFlightTime(cruiseTime)}
Estimated Block Time (incl. taxi & ground ops): ${formatFlightTime(blockTime)}

Aircraft: ${aircraft.model} (${aircraftCode})

`;

    if (nm > aircraft.maxRangeNM) {
      message += "\nWarning: This aircraft is not capable of flying this distance non-stop. Please choose a different aircraft or consider a stopover.";
    }

    const resultDiv = document.getElementById('result');
    resultDiv.textContent = message;
    resultDiv.style.display = 'block';

  } catch (error) {
    alert('Error fetching data: ' + error.message);
    console.error(error);
  }
}
</script>

</body>
</html>
